# Инструкции по запуску проекта SubTracker

## Предварительные требования

1. **Java 17+** - для сборки и запуска проекта
2. **PostgreSQL** - для работы backend'а
3. **Node.js** - для сборки web-frontend'а
4. **Git** - для клонирования репозитория

## Настройка базы данных

1. Установите и запустите PostgreSQL
2. Создайте базу данных:
   ```sql
   CREATE DATABASE subtracker;
   ```
3. Создайте пользователя (опционально):
   ```sql
   CREATE USER subtracker_user WITH PASSWORD 'password';
   GRANT ALL PRIVILEGES ON DATABASE subtracker TO subtracker_user;
   ```

## Настройка переменных окружения

Создайте файл `.env` в корне проекта или установите переменные окружения:

```bash
# База данных
DATABASE_URL=jdbc:postgresql://localhost:5432/subtracker
DATABASE_USER=postgres
DATABASE_PASSWORD=password

# Telegram Bot (для модуля telegram-bot)
TELEGRAM_BOT_TOKEN=ваш_токен_бота
```

## Сборка проекта

1. Клонируйте репозиторий:
   ```bash
   git clone <url_репозитория>
   cd SubTracker
   ```

2. Соберите весь проект:
   ```bash
   ./gradlew build
   ```

## Запуск модулей

### 1. Backend (API сервер)

```bash
cd backend
../gradlew run
```

Backend будет доступен по адресу: `http://localhost:8080`

**API endpoints:**
- `GET /subscriptions` - получить все подписки
- `GET /subscriptions/{userId}` - получить подписки пользователя
- `POST /subscriptions` - создать новую подписку
- `DELETE /subscriptions/{id}` - удалить подписку

### 2. Web Frontend

```bash
cd web-frontend
../gradlew browserDevelopmentRun
```

Web-интерфейс будет доступен по адресу: `http://localhost:3000`

**Возможности:**
- Просмотр списка подписок
- Добавление новых подписок через модальное окно
- Удаление подписок
- Статистика по расходам
- Responsive дизайн

### 3. Telegram Bot

1. Создайте бота через [@BotFather](https://t.me/botfather)
2. Получите токен бота
3. Установите переменную окружения `TELEGRAM_BOT_TOKEN`
4. Запустите бота:

```bash
cd telegram-bot
../gradlew run
```

**Команды бота:**
- `/start` - начать работу с ботом
- `/list` - показать все подписки
- `/add` - добавить новую подписку
- `/delete [id]` - удалить подписку
- `/stats` - показать статистику
- `/help` - справка

## Запуск тестов

### Все тесты:
```bash
./gradlew test
```

### Тесты конкретного модуля:
```bash
./gradlew :backend:test
./gradlew :web-frontend:test
./gradlew :shared:test
```

## Структура проекта

```
SubTracker/
├── shared/              # Общие модели и интерфейсы
│   ├── src/commonMain/  # Общий код
│   └── src/commonTest/  # Общие тесты
├── backend/             # Backend API (Ktor + Exposed + PostgreSQL)
│   ├── src/jvmMain/     # Исходный код
│   └── src/jvmTest/     # Тесты
├── web-frontend/        # Web-интерфейс (Kotlin/JS)
│   ├── src/jsMain/      # Исходный код
│   └── src/jsTest/      # Тесты
├── telegram-bot/        # Telegram бот
│   └── src/             # Исходный код
├── build.gradle.kts     # Корневой build script
├── settings.gradle.kts  # Настройки проекта
└── README.md           # Документация
```

## Технологии

- **Kotlin Multiplatform** - общий код для всех платформ
- **Ktor** - веб-фреймворк для backend
- **Exposed** - ORM для работы с базой данных
- **PostgreSQL** - основная база данных
- **H2** - тестовая база данных
- **Kotlin/JS** - для web-frontend
- **Telegram Bot API** - для Telegram бота
- **JUnit 5** - для тестирования

## Troubleshooting

### База данных не подключается
1. Проверьте, что PostgreSQL запущен
2. Проверьте правильность настроек подключения
3. Убедитесь, что база данных создана

### Web-frontend не загружается
1. Убедитесь, что backend запущен на порту 8080
2. Проверьте настройки CORS в backend
3. Откройте консоль разработчика для просмотра ошибок

### Telegram бот не отвечает
1. Проверьте правильность токена бота
2. Убедитесь, что backend API доступен
3. Проверьте логи бота в консоли

### Ошибки сборки
1. Убедитесь, что используется Java 17+
2. Очистите кэш Gradle: `./gradlew clean`
3. Пересоберите проект: `./gradlew build --refresh-dependencies`

## Дальнейшее развитие

Проект готов к дальнейшему развитию. Основные направления:

1. **Аутентификация** - добавить систему пользователей
2. **Уведомления** - напоминания о платежах
3. **Аналитика** - графики и отчеты
4. **Мобильное приложение** - нативные приложения для iOS/Android
5. **CI/CD** - автоматическая сборка и деплой

Все основные компоненты реализованы и готовы к использованию!
