# Инструкции по запуску проекта SubTracker

## Предварительные требования

1. **Java 17+** - для сборки и запуска проекта
2. **PostgreSQL** - для работы backend'а
3. **Node.js** - для сборки web-frontend'а
4. **Git** - для клонирования репозитория
5. **Docker** (опционально) - для запуска через контейнеры

## Настройка базы данных

1. Установите и запустите PostgreSQL
2. Создайте базу данных:
   ```sql
   CREATE DATABASE subtracker;
   ```
3. Создайте пользователя (опционально):
   ```sql
   CREATE USER subtracker_user WITH PASSWORD 'password';
   GRANT ALL PRIVILEGES ON DATABASE subtracker TO subtracker_user;
   ```

## Настройка переменных окружения

### Способ 1: Файл .env (рекомендуется)

1. Скопируйте файл с примером:
   ```bash
   cp env.example .env
   ```

2. Отредактируйте `.env` файл и заполните своими значениями:
   ```bash
   # База данных
   DATABASE_URL=jdbc:postgresql://localhost:5432/subtracker
   DATABASE_USER=postgres
   DATABASE_PASSWORD=your_real_password
   
   # Настройки JWT аутентификации
   JWT_SECRET=your_jwt_secret_here
   JWT_ISSUER=your_issuer_here
   JWT_AUDIENCE=your_audience_here
   JWT_REALM=your_realm_here
   
   # Telegram Bot (получите у @BotFather)
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrSTUvwxYZ1234567890
   ```

### Способ 2: Переменные окружения системы

```bash
export DATABASE_URL="jdbc:postgresql://localhost:5432/subtracker"
export DATABASE_USER="postgres" 
export DATABASE_PASSWORD="your_password"
export JWT_SECRET="your_jwt_secret_here"
export JWT_ISSUER="your_issuer_here"
export JWT_AUDIENCE="your_audience_here"
export JWT_REALM="your_realm_here"
export TELEGRAM_BOT_TOKEN="your_bot_token"
```

⚠️ **Безопасность:** 
- Файл `.env` уже добавлен в `.gitignore` и не попадет в репозиторий
- Никогда не коммитьте реальные токены и пароли
- Используйте файл `env.example` как шаблон

## Сборка проекта

1. Клонируйте репозиторий:
   ```bash
   git clone <url_репозитория>
   cd SubTracker
   ```

2. Соберите весь проект:
   ```bash
   ./gradlew build
   ```

## Запуск модулей

### 1. Backend (API сервер)

```bash
cd backend
../gradlew run
```

Backend будет доступен по адресу: `http://localhost:8080`

**API endpoints:**
- `POST /login` - аутентификация пользователя
- `POST /register` - регистрация нового пользователя
- `GET /subscriptions` - получить все подписки (требуется аутентификация)
- `GET /subscriptions/{userId}` - получить подписки пользователя (требуется аутентификация)
- `POST /subscriptions` - создать новую подписку (требуется аутентификация)
- `DELETE /subscriptions/{id}` - удалить подписку (требуется аутентификация)

### 2. Web Frontend

```bash
cd web-frontend
../gradlew browserDevelopmentRun
```

Web-интерфейс будет доступен по адресу: `http://localhost:3000`

**Возможности:**
- Просмотр списка подписок
- Добавление новых подписок через модальное окно
- Удаление подписок
- Статистика по расходам
- Responsive дизайн
- Аутентификация пользователей

### 3. Telegram Bot

1. Создайте бота через [@BotFather](https://t.me/botfather)
2. Получите токен бота
3. Установите переменную окружения `TELEGRAM_BOT_TOKEN`
4. Запустите бота:

```bash
cd telegram-bot
../gradlew run
```

**Команды бота:**
- `/start` - начать работу с ботом
- `/list` - показать все подписки
- `/add` - добавить новую подписку
- `/delete [id]` - удалить подписку
- `/stats` - показать статистику
- `/help` - справка
- `/login` - аутентификация в системе

## Запуск тестов

### Все тесты:
```bash
./gradlew test
```

### Тесты конкретного модуля:
```bash
./gradlew :backend:test
./gradlew :web-frontend:test
./gradlew :shared:test
```

## Структура проекта

```
SubTracker/
├── shared/              # Общие модели и интерфейсы
│   ├── src/commonMain/  # Общий код
│   └── src/commonTest/  # Общие тесты
├── backend/             # Backend API (Ktor + Exposed + PostgreSQL)
│   ├── src/jvmMain/     # Исходный код
│   └── src/jvmTest/     # Тесты
├── web-frontend/        # Web-интерфейс (Kotlin/JS)
│   ├── src/jsMain/      # Исходный код
│   └── src/jsTest/      # Тесты
├── telegram-bot/        # Telegram бот
│   └── src/             # Исходный код
├── build.gradle.kts     # Корневой build script
├── settings.gradle.kts  # Настройки проекта
└── README.md           # Документация
```

## Технологии

- **Kotlin Multiplatform** - общий код для всех платформ
- **Ktor** - веб-фреймворк для backend
- **Exposed** - ORM для работы с базой данных
- **PostgreSQL** - основная база данных
- **H2** - тестовая база данных
- **Kotlin/JS** - для web-frontend
- **Telegram Bot API** - для Telegram бота
- **JWT** - аутентификация пользователей
- **JUnit 5** - для тестирования

## Troubleshooting

### База данных не подключается
1. Проверьте, что PostgreSQL запущен
2. Проверьте правильность настроек подключения
3. Убедитесь, что база данных создана

### Web-frontend не загружается
1. Убедитесь, что backend запущен на порту 8080
2. Проверьте настройки CORS в backend
3. Откройте консоль разработчика для просмотра ошибок

### Telegram бот не отвечает
1. Проверьте правильность токена бота
2. Убедитесь, что backend API доступен
3. Проверьте логи бота в консоли

### Ошибки сборки
1. Убедитесь, что используется Java 17+
2. Очистите кэш Gradle: `./gradlew clean`
3. Пересоберите проект: `./gradlew build --refresh-dependencies`

## Дальнейшее развитие

Проект готов к дальнейшему развитию. Основные направления:

1. **Аналитика** - графики и отчеты
2. **Уведомления** - напоминания о платежах
3. **Экспорт данных** - в CSV, Excel и другие форматы
4. **Мобильное приложение** - нативные приложения для iOS/Android
5. **Категории подписок** - группировка подписок по категориям

Все основные компоненты реализованы и готовы к использованию!
