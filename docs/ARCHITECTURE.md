# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SubTracker

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

SubTracker —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π:

```
SubTracker/
‚îú‚îÄ‚îÄ üñ•Ô∏è backend/             # REST API (Kotlin + Spring Boot 3 + SQLite/PostgreSQL)
‚îú‚îÄ‚îÄ üåê web-frontend/        # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Next.js + TypeScript)
‚îî‚îÄ‚îÄ ü§ñ telegram-bot/        # Telegram –±–æ—Ç (Python + aiogram)
```

### üîß –ú–æ–¥—É–ª–∏

#### üñ•Ô∏è **:backend** - API —Å–µ—Ä–≤–µ—Ä
- **Spring Boot 3** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Kotlin** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **Spring Data JPA** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Spring Security** –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **JWT** –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **HikariCP** –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **SQLite** –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **PostgreSQL** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- RESTful API endpoints
- –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

#### üåê **:web-frontend** - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **Next.js** —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **TypeScript** –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Tailwind CSS** –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π responsive –¥–∏–∑–∞–π–Ω
- –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API —á–µ—Ä–µ–∑ fetch
- –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user/user
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

#### ü§ñ **:telegram-bot** - Telegram –±–æ—Ç
- **Python** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **aiogram** —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏
- –ü–æ—à–∞–≥–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend/Bot
    participant B as Backend
    participant DB as Database
    
    U->>F: –í–≤–æ–¥ username/password
    F->>B: POST /api/login {username, password}
    B->>DB: SELECT user WHERE username=?
    DB-->>B: UserModel
    B->>B: SecurityUtils.verifyPassword()
    B-->>F: AuthResponse{success, token}
    F->>F: localStorage.setItem('authToken', token)
    F-->>U: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ dashboard
```

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend/Bot
    participant B as Backend
    participant DB as Database
    
    U->>F: –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
    F->>B: GET /api/subscriptions (Authorization: Bearer token)
    B->>B: JWT validation
    B->>DB: SELECT * FROM subscriptions
    DB-->>B: List<SubscriptionData>
    B-->>F: List<SubscriptionResponse>
    F->>F: displaySubscriptions()
    F-->>U: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
    
    U->>F: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
    F->>B: POST /api/subscriptions {subscriptionData}
    B->>DB: INSERT INTO subscriptions
    DB-->>B: Created subscription
    B-->>F: SubscriptionResponse
    F-->>U: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
```

## üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ Users
```sql
CREATE TABLE Users (
    id TEXT PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    telegram_id BIGINT UNIQUE,
    created_at DATE NOT NULL,
    updated_at DATE NOT NULL
);
```

### –¢–∞–±–ª–∏—Ü–∞ Subscriptions
```sql
CREATE TABLE Subscriptions (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    name TEXT NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    currency TEXT NOT NULL,
    billing_cycle TEXT NOT NULL,
    next_payment_date DATE NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATE NOT NULL,
    updated_at DATE NOT NULL,
    FOREIGN KEY (user_id) REFERENCES Users(id)
);
```

## üîí –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### JWT Authentication Flow

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–í—Ö–æ–¥:**
   - –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ SHA-256
   - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
   - –¢–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç claims: username, userId, audience, issuer

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç `Authorization: Bearer <token>`
   - JWT —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
   - –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401 Unauthorized

3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JWT:**
```kotlin
val jwtSecret = "your_secret_key" // –ò–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
val jwtIssuer = "SubTracker"
val jwtAudience = "users"
val jwtRealm = "ktor.io"
```

### CORS Configuration
```kotlin
@Configuration
class CorsConfig {
    @Bean
    fun corsConfigurationSource(): CorsConfigurationSource {
        val configuration = CorsConfiguration()
        configuration.allowedOrigins = listOf("http://localhost:3000")
        configuration.allowedMethods = listOf("GET", "POST", "PUT", "DELETE", "OPTIONS")
        configuration.allowedHeaders = listOf("*")
        configuration.allowCredentials = true
        
        val source = UrlBasedCorsConfigurationSource()
        source.registerCorsConfiguration("/**", configuration)
        return source
    }
}